!function(){define("library/adapter",["./uuid","./document","./change-observer","exports"],function(a,b,c,d){"use strict";var e=a["default"],f=b["default"],g=c["default"];d["default"]=DS.Adapter.extend(Ember.ActionHandler,{documentSource:null,documentId:Ember.computed.alias("documentSource.id"),defaultSerializer:"-google-drive",document:function(){return Ember.assert("A document id was not assigned. Make sure you set a document id in a route before the store is accessed",this.get("documentId")),f.find(this.get("documentId"))}.property("documentId"),_actions:{recordCreatedRemotely:function(a,b,c){a.push(b,c)},recordUpdatedRemotely:function(a,b,c){a.push(b,c)},recordDeletedRemotely:function(a,b,c){var d=a.getById(b,c);a.unloadRecord(d)}},ref:function(){return this.get("document").then(function(a){return a.ref().then(function(a){window.ref=a}),a.ref()})},changeObserver:function(){return g.create({ref:this.ref(),target:this})}.property(),observeRecordData:function(a,b,c){return this.get("changeObserver").observeRecordData(a,b,c)},observeIdentityMap:function(a,b){return this.get("changeObserver").observeIdentityMap(a,b)},generateIdForRecord:function(){return e()},find:function(a,b,c){var d=this;return this.ref().then(function(e){return d.observeRecordData(a,b.typeKey,c),e.get(b.typeKey,c).value()})},createRecord:function(a,b,c){var d=this;return this.ref().then(function(e){var f=c.serialize({includeId:!0}),g=c.get("id");return e.begin(),e.get(b.typeKey,g).set(f),e.end(),d.observeRecordData(a,b.typeKey,g),e.get(b.typeKey,g).value()})},updateRecord:function(a,b,c){var d=this;return this.ref().then(function(e){var f=c.serialize({includeId:!0}),g=c.get("id");return e.begin(),e.get(b.typeKey,g).set(f),e.end(),d.observeRecordData(a,b.typeKey,g),e.get(b.typeKey,g).value()})},findAll:function(a,b){var c=this;return this.ref().then(function(d){for(var e=d.get(b.typeKey).value()||{},f=d.get(b.typeKey).keys(),g=[],h=0;h<f.length;h++)g.push(e[f[h]]);return c.observeIdentityMap(a,b.typeKey),g.forEach(function(d){c.observeRecordData(a,b.typeKey,d.id)}),g})},deleteRecord:function(a,b,c){return this.ref().then(function(a){var d=c.get("id");a.get(b.typeKey).delete(d)})}})}),define("library/auth",["exports"],function(a){"use strict";var b="https://www.googleapis.com/auth/drive.install",c="https://www.googleapis.com/auth/drive.file",d="openid";a["default"]=Ember.StateManager.extend({enableLogging:!1,initialState:"loggedOut",user:null,isLoggedIn:Ember.computed.alias("isAuthenticated"),clientID:ENV.GOOGLE_CLIENT_ID,userID:Ember.computed.alias("user.id"),permissions:[b,c,d],token:function(){return gapi.auth.getToken().access_token}.property("currentState"),whenLoggedIn:function(a){this.get("isLoggedIn")?a():this.one("loggedin",function(){a()})},checkStatus:function(){if(this.get("isAuthenticated"))return Ember.RSVP.resolve(this.get("user"));var a=this;return a.transitionTo("checking"),a._fetchLoginState().then(function(){return a.transitionTo("loggingIn.fetchingUser"),a._fetchUserObject()},function(b){return a.transitionTo("loggedOut.known"),Ember.RSVP.reject(b)},"checkStatus _fetchLoginState handler").then(function(b){return a.transitionTo("loggedIn"),a.set("user",b),b},null,"checkState _fetchUserObject handler")},login:function(){this.transitionTo("loggingIn.showingPrompt")},_fetchLoginState:function(){var a=this;return new Ember.RSVP.Promise(function(b,c){gapi.auth.authorize({client_id:a.get("clientID"),user_id:a.get("userID"),scope:a.get("permissions"),immediate:!0},function(a){a&&!a.error?Ember.run(null,b):Ember.run(null,c,a&&a.error?a.error:"unauthenticated")})},"GoogleDriveAuth _fetchLoginState")},_fetchUserObject:function(){return new Ember.RSVP.Promise(function(a,b){gapi.client.oauth2.userinfo.get().execute(function(c){c.id?Ember.run(null,a,c):Ember.run(null,b)})},"GoogleDriveAuth _fetchUserObject")},states:{loggedOut:Ember.State.create({initialState:"unknown",unknown:Ember.State.create(),enter:function(){this.set("isUnauthenticated",!0)},exit:function(){this.set("isUnauthenticated",!1)},checking:Ember.State.create(),known:Ember.State.create(),loginFailed:Ember.State.create()}),loggedIn:Ember.State.create({enter:function(a){a.trigger("loggedin"),a.set("isAuthenticated",!0)},exit:function(a){a.trigger("loggedout"),a.set("isAuthenticated",!1)}}),loggingIn:Ember.State.create({fetchingUser:Ember.State.create(),showingPrompt:Ember.State.create({enter:function(a){var b=function(b){a.transitionTo(b&&!b.error?"fetchingUser":"loggedOut.loginFailed")};gapi.auth.authorize({client_id:a.get("clientID"),user_id:a.get("userID"),scope:a.get("permissions"),immediate:!1},b)}})})}})}),define("library/change-observer",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend(Ember.ActionHandler,{ref:null,target:null,observedMap:function(){return{}}.property(),observeRecordData:function(a,b,c){var d=this,e=this.get("observedMap"),f=[b,c].join("/");return this.contains(f)?Ember.RSVP.Promise.resolve():(e[f]=!0,this.get("ref").then(function(e){e.get(b,c).changed(function(e){"object_changed"==e.type&&Ember.run.once(d,"recordDataChanged",a,b,c,e)})}))},observeIdentityMap:function(a,b){var c=this,d=this.get("observedMap"),e=[b].join("/");return this.contains(e)?Ember.RSVP.Promise.resolve():(d[e]=!0,this.get("ref").then(function(d){d.get(b).materialize().changed(function(d){d.isLocal||window.vals.push(d),"value_changed"==d.type&&Ember.run.once(c,"identityMapChanged",a,b,d)})}))},contains:function(a){var b=this.get("observedMap");return b[a]},recordDataChanged:function(a,b,c,d){if(d.isLocal)this.send("recordUpdatedLocally",a,b,c);else{var e=this;this.get("ref").then(function(d){var f=d.get(b,c).value();e.send("recordUpdatedRemotely",a,b,f)})}},identityMapChanged:function(a,b,c){var d=this;if(c.isLocal&&null==c.oldValue&&c.newValue)this.send("recordCreatedLocally",a,b,c.newValue.get("id"));else if(c.isLocal&&c.oldValue&&null==c.newValue)this.send("recordDeletedLocally",a,b,c.oldValue.get("id"));else if(!c.isLocal&&null==c.oldValue&&c.newValue){var e=c.newValue.get("id");this.get("ref").then(function(c){var f=c.get(b,e).value();d.send("recordCreatedRemotely",a,b,f)})}else if(!c.isLocal&&c.oldValue&&null==c.newValue){var f=c.oldValue.get("id");this.send("recordDeletedRemotely",a,b,f)}}})}),define("library/document-source",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend({id:null})}),define("library/document",["./reference","exports"],function(a,b){"use strict";var c=a["default"],d=Ember.Object.extend(Ember.Evented,{id:Ember.computed.alias("file.id"),title:Ember.computed.alias("file.title"),isEditable:Ember.computed.alias("file.editable"),file:null,doc:null,isLoaded:!1,loadPromise:null,init:function(a){Ember.assert("You must pass in a valid google file.",!!a),this.set("file",a),this.get("collaborators",Ember.A()),this.load()},load:function(){if(this.get("loadPromise"))return this.get("loadPromise");var a=this,b=function(){a.onLoad.apply(a,arguments),a.set("isLoaded",!0)},c=function(){a.onError.apply(a,arguments)},d=new Ember.RSVP.Promise(function(b,c){gapi.drive.realtime.load(a.get("id"),function(a){Ember.run(null,b,a)},Ember.K,function(a){Ember.run(null,c,a)})}).then(b,c).then(function(){return a});return this.set("loadPromise",d),d},ref:function(){return this.load().then(function(a){return new c(a.get("model"),null,null,a.get("root"))})},begin:function(){this.get("model").beginCompoundOperation()},end:function(){this.get("model").endCompoundOperation()},root:function(){return this.get("model").getRoot()}.property("model"),model:function(){return this.get("doc").getModel()}.property("doc"),onLoad:function(a){this.set("doc",a),this.trigger("loaded"),this.refreshCollaborators(),this.setupCollaboratorEventListeners()},onError:function(a){a.type==gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?this.authorizeWithGoogle():a.type==gapi.drive.realtime.ErrorType.CLIENT_ERROR?alert("An Error happened: "+a.message):a.type==gapi.drive.realtime.ErrorType.NOT_FOUND&&alert("The file was not found. It does not exist or you do not have read access to the file.")},unresolvedLocalChanges:0,undo:function(){this.canUndo()&&(this.incrementProperty("unresolvedLocalChanges"),this.get("model").undo())},redo:function(){this.canRedo()&&(this.incrementProperty("unresolvedLocalChanges"),this.get("model").redo())},canUndo:function(){return this.get("model").canUndo},canRedo:function(){return this.get("model").canRedo},collaborators:[],refreshCollaborators:function(){var a=this.get("doc").getCollaborators();this.set("collaborators",a)},setupCollaboratorEventListeners:function(){var a=this.get("doc"),b=this;a.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_LEFT,function(){b.refreshCollaborators()}),a.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_JOINED,function(){b.refreshCollaborators()})}}),e={};d.reopenClass({find:function(a){return e[a]?e[a]:(e[a]=new Ember.RSVP.Promise(function(b,c){gapi.client.drive.files.get({fileId:a}).execute(function(a){a.error?c(a):b(new d(a))})}),e[a])},create:function(a){var b=this;return b._sendCreateRequest(a).then(function(a){return a.error?Ember.RSVP.reject(a):new d(a)})},_sendCreateRequest:function(a){return new Ember.RSVP.Promise(function(b){gapi.client.drive.files.insert({resource:{mimeType:ENV.GOOGLE_MIME_TYPE,title:Ember.get(a,"title")}}).execute(function(a){Ember.run(null,b,a)})})}}),b["default"]=d}),define("library/loader",["exports"],function(a){"use strict";var b={};b.load=function(){var a=0,b=4;return new Ember.RSVP.Promise(function(c){gapi.load("auth:client,drive-realtime,drive-share",function(){gapi.client.load("oauth2","v2",function(){a++,a>=b&&c()}),gapi.client.load("drive","v2",function(){a++,a>=b&&c()}),gapi.load("drive-share",function(){a++,a>=b&&c()}),gapi.load("picker",function(){a++,a>=b&&c()})})})},a["default"]=b}),define("library/picker",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend(Ember.Evented,{token:null,apiKey:ENV.GOOGLE_API_KEY,mimeTypes:ENV.GOOGLE_MIME_TYPE,show:function(){this.get("googlePicker").setVisible(!0)},googlePicker:function(){var a=this.googlePickerCallback.bind(this),b=this.get("token"),c=this.get("apiKey"),d=this.get("mimeTypes"),e=new google.picker.View(google.picker.ViewId.DOCS);return e.setMimeTypes(d),(new google.picker.PickerBuilder).addView(e).enableFeature(google.picker.Feature.NAV_HIDDEN).setDeveloperKey(c).setSelectableMimeTypes(d).setOAuthToken(b).setCallback(a).build()}.property("token"),googlePickerCallback:function(a){a.action==google.picker.Action.PICKED&&this.trigger("selected",a.docs[0])}})}),define("library/reference",["exports"],function(a){"use strict";var b=function(a,b){if(!b)throw new Error("Assertion failed: "+a)},c=function(a){return Object(a)===a&&Object.getPrototypeOf(a)===Object.prototype},d=function(a){return a instanceof Array},e=function(){if(d(arguments[0]))return e.apply(this,arguments[0]);for(var a=arguments,b=this,c=0;c<a.length;c++)b=b._get(a[c]);return b},f=function(a,b,c,d){this.model=a,this.parent=b,this.key=c,this.data=d};f.isFor=function(a){return a instanceof gapi.drive.realtime.CollaborativeMap},f.serialize=function(a){var b={};return a.items().forEach(function(a){b[a[0]]=i(a[1])}),b},f.prototype.path=function(a){return this.parent?this.parent.path(this.key)+(a?"/"+a:""):a||""},f.prototype.keys=function(){return this.data.keys()},f.prototype.get=function(){return e.apply(this,arguments)},f.prototype._get=function(a){var b=this.data.get(a);return g.isFor(b)?new g(this.model,this,a):f.isFor(b)?new f(this.model,this,a,b):b},f.prototype.set=function(a){if(arguments.length>1)this.data.set(arguments[0],this._coerce(arguments[1]));else if(c(a)){this.data.clear();for(var b=Object.keys(a),d=0;d<b.length;d++)this.data.set(b[d],a[b[d]])}else this.parent.set(this.key,a);return this.parent?this.parent.get(this.key):this},f.prototype.value=function(){return i(this.data)},f.prototype.delete=function(a){return this.data.delete(a),this},f.prototype.materialize=function(){return this},f.prototype.changed=function(a){return this.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,a),this.data.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,a),this},f.prototype._coerce=function(a){return c(a)?this.model.createMap(a):a},f.prototype.value=function(){return i(this.data)},f.prototype.begin=function(){return this.model.beginCompoundOperation()},f.prototype.end=function(){return this.model.endCompoundOperation()};var g=function(a,b,c){this.model=a,this.parent=b,this.key=c};g.isFor=function(a){return null==a},g.prototype.path=function(a){return this.parent.path(this.key)+(a?"/"+a:"")},g.prototype.keys=function(){return[]},g.prototype.get=function(){return e.apply(this,arguments)},g.prototype._get=function(a){return new g(this.model,this,a)},g.prototype.set=function(a){var b=this.materialize();return b.set(a),b},g.prototype.delete=function(){return this},g.prototype.value=function(){return null},g.prototype.materialize=function(){var a=this.parent.materialize();return a.set(this.key,this.model.createMap()),a.get(this.key)},g.prototype.changed=function(){b("You must materialize a NullReference before adding a listener")};var h=function(a){var b=[];return a.asArray().forEach(function(a){b.push(i(a))}),b},i=function(a){return f.isFor(a)?f.serialize(a):a instanceof gapi.drive.realtime.CollaborativeList?h(a):a};a["default"]=f}),define("library/serializer",["exports"],function(a){"use strict";var b=Ember.get,c=function(a){return a.get("id")},d=function(a){return{id:a.get("id"),type:a.constructor.typeKey}};a["default"]=DS.JSONSerializer.extend({serializeHasMany:function(a,e,f){var g=f.key,h=DS.RelationshipChange.determineRelationshipType(a.constructor,f);if("manyToNone"===h||"manyToMany"===h){var i=f.options.polymorphic?d:c;e[g]=b(a,g).map(i)}}})}),define("library/share-dialog",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend({appID:ENV.GOOGLE_DRIVE_SDK_APP_ID,fileID:Ember.required(),show:function(){var a=this.get("appID"),b=this.get("fileID"),c=new gapi.drive.share.ShareClient(a);c.setItemIds([b]),c.showSettingsDialog()}})}),define("library/state",["exports"],function(a){"use strict";var b=function(){var a={};return location.search.substr(1).split("&").forEach(function(b){a[b.split("=")[0]]=decodeURIComponent(b.split("=")[1])}),a};a["default"]=Ember.Object.extend({application:Ember.required(),redirectToFileIfProvided:function(){this.fileProvided()&&this.redirectToFile(this.get("fileID"))},redirectToFile:function(a){window.location=this.redirectToFilePath(a)},redirectToFilePath:function(a){return window.location.pathname+"#/project/"+a},fileID:function(){return this.get("fileIDs").objectAt(0)}.property("fileIDs"),fileProvided:function(){return"open"==this.get("action")&&this.get("fileIDs")},queryParams:function(){return b()}.property(),state:function(){try{return JSON.parse(this.get("queryParams.state"))}catch(a){return null}}.property("queryParams"),action:Ember.computed.alias("state.action"),userID:Ember.computed.alias("state.userId"),fileIDs:Ember.computed.alias("state.ids"),folderID:Ember.computed.alias("state.folderId")})}),define("library/uuid",["exports"],function(a){"use strict";var b="0123456789abcdefghijklmnopqrstuvwxyz",c=b.length,d=0,e=[];a["default"]=function(){var a=new Date,f=a===d;d=a;for(var g=new Array(8),h=7;h>=0;h--)g[h]=b.charAt(a%c),a=Math.floor(a/c);var i=g.join("");if(f){for(h=11;h>=0&&e[h]===c-1;h--)e[h]=0;e[h]++}else for(h=0;12>h;h++)e[h]=Math.floor(Math.random()*c);for(h=0;12>h;h++)i+=b.charAt(e[h]);return i}}),define("library",["./my_library/adapter","./my_library/auth","./my_library/document","./my_library/document-source","./my_library/picker","./my_library/reference","./my_library/share-dialog","./my_library/state","exports"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=a["default"],k=b["default"],l=c["default"],m=d["default"],n=e["default"],o=f["default"],p=g["default"],q=h["default"],r={Adapter:j,Auth:k,Document:l,DocumentSource:m,FilePicker:n,Reference:o,ShareDialog:p,State:q};i.GDrive=r})}();