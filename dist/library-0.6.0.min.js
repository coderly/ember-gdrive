!function(){define("ember-gdrive/adapter",["./uuid","./document","./change-observer","./util","exports"],function(a,b,c,d,e){"use strict";var f=a["default"],g=(b["default"],c["default"]),h=d.modelKey,i=DS.Adapter.extend(Ember.ActionHandler,{defaultSerializer:"-google-drive",documentSource:null,document:Ember.computed.alias("documentSource.document"),ref:Ember.computed.alias("document.ref"),_actions:{recordCreatedRemotely:function(a,b,c){a.push(b,c)},recordUpdatedRemotely:function(a,b,c){a.push(b,c)},recordDeletedRemotely:function(a,b,c){var d=a.getById(b,c);a.unloadRecord(d)},recordCreatedLocally:function(a,b,c){0==this.get("document.openSaveCount")&&a.push(b,c)},recordUpdatedLocally:function(a,b,c){0==this.get("document.openSaveCount")&&a.push(b,c)},recordDeletedLocally:function(a,b,c){if(0==this.get("document.openSaveCount")){var d=a.getById(b,c);a.unloadRecord(d)}}},changeObserver:function(){return g.create({ref:this.get("ref"),target:this})}.property(),observeRecordData:function(a,b,c){return this.get("changeObserver").observeRecordData(a,b,c)},observeIdentityMap:function(a,b){return this.get("changeObserver").observeIdentityMap(a,b)},generateIdForRecord:function(){return f()},find:function(a,b,c){return this.observeRecordData(a,b.typeKey,c),Ember.RSVP.resolve(this.get("ref").get(h(b),c).value())},createRecord:function(a,b,c){var d=c.serialize({includeId:!0}),e=c.get("id"),f=this.get("ref");return this.beginSave("createRecord"),f.get(h(b),e).set(d),this.endSave("createRecord"),this.observeRecordData(a,b.typeKey,e),Ember.RSVP.resolve(this.get("ref").get(h(b),e).value())},updateRecord:function(a,b,c){var d=c.serialize({includeId:!0}),e=c.get("id"),f=this.get("ref");return this.beginSave("updateRecord"),f.get(h(b),e).set(d),this.endSave("updateRecord"),this.observeRecordData(a,b.typeKey,e),Ember.RSVP.resolve(f.get(h(b),e).value())},findAll:function(a,b){for(var c=this,d=this.get("ref"),e=d.get(h(b)).value()||{},f=d.get(h(b)).keys(),g=[],i=0;i<f.length;i++)g.push(e[f[i]]);return this.observeIdentityMap(a,b.typeKey),g.forEach(function(d){c.observeRecordData(a,b.typeKey,d.id)}),Ember.RSVP.resolve(g)},deleteRecord:function(a,b,c){var d=this.get("ref"),e=c.get("id");return d.get(h(b)).delete(e),Ember.RSVP.resolve()},undo:function(){this.get("document").undo()},redo:function(){this.get("document").redo()},beginSave:function(a){this.get("document").beginSave(a)},endSave:function(a){this.get("document").endSave(a)}});e["default"]=i}),define("ember-gdrive/auth",["exports"],function(a){"use strict";var b="https://www.googleapis.com/auth/drive.install",c="https://www.googleapis.com/auth/drive.file",d="openid",e=function(a,b){return Ember.merge(a||{},b||{})},f=Ember.Object.extend();f.reopenClass({isAuthenticated:!1,isUnauthenticated:Ember.computed.not("isAuthenticated"),user:null,userID:Ember.computed.alias("user.id"),clientID:ENV.GOOGLE_CLIENT_ID,permissions:[b,c,d],authorize:function(a){var b=e({client_id:this.clientID,scope:this.permissions,authuser:-1,immediate:!1,cookie_policy:"single_host_origin"},a||{});return new Ember.RSVP.Promise(function(a,c){console.log("authorize",b),gapi.auth.authorize(b,function(b){b&&!b.error?Ember.run(null,a,b):Ember.run(null,c,b&&b.error?b.error:"unauthenticated")})},"ember-gdrive: Auth#authorize")},authorizeImmediate:function(a){return this.authorize(e({immediate:!0},a))},fetchCurrentUser:function(){return new Ember.RSVP.Promise(function(a,b){gapi.client.oauth2.userinfo.get().execute(function(c){c.id?Ember.run(null,a,c):Ember.run(null,b)})},"GoogleDriveAuth _fetchUserObject")},close:function(){return new Ember.RSVP.Promise(function(a){gapi.auth.signOut(),a()})}}),a["default"]=f}),define("ember-gdrive/boot",["ember-gdrive/auth","ember-gdrive/document-source","ember-gdrive/loader","ember-gdrive/adapter","ember-gdrive/serializer"],function(a,b,c,d,e){"use strict";var f=a["default"],g=b["default"],h=c["default"],i=d["default"],j=e["default"];Ember.onLoad("Ember.Application",function(a){a.initializer({name:"google-drive",after:"store",initialize:function(a,b){b.register("adapter:-google-drive",i),b.register("serializer:-google-drive",j),b.register("document-source:main",g),b.inject("route","documentSource","document-source:main"),b.inject("controller","documentSource","document-source:main"),b.inject("adapter:application","documentSource","document-source:main"),b.inject("document-source:main","auth","auth:google")}}),a.initializer({name:"requireGoogleLibraries",before:"googleDriveAuth",initialize:function(a,b){b.deferReadiness(),h.load().then(function(){b.advanceReadiness()})}}),a.initializer({name:"googleDriveAuth",before:"store",initialize:function(a,b){b.register("auth:google",f,{instantiate:!1}),b.inject("controller","auth","auth:google"),b.inject("route","auth","auth:google")}})})}),define("ember-gdrive/change-observer",["./util","exports"],function(a,b){"use strict";{var c=a.normalizeTypeKey;a.pluck}b["default"]=Ember.Object.extend(Ember.ActionHandler,{ref:null,target:null,observedMap:function(){return{}}.property(),observeRecordData:function(a,b,d){var e=this,f=this.get("observedMap"),g=[c(b),d].join("/"),h=this.get("ref");return this.contains(g)?Ember.RSVP.Promise.resolve():(f[g]=!0,void h.get(c(b),d).changed(function(c){"value_changed"==c.type&&Ember.run(function(){e.recordDataChanged(a,b,d,c)})}))},observeIdentityMap:function(a,b){var d=this,e=this.get("observedMap"),f=[c(b)].join("/"),g=this.get("ref");return this.contains(f)?Ember.RSVP.Promise.resolve():(e[f]=!0,void g.get(c(b)).materialize().changed(function(c){"value_changed"==c.type&&Ember.run.once(d,"identityMapChanged",a,b,c)}))},contains:function(a){var b=this.get("observedMap");return b[a]},recordDataChanged:function(a,b,d,e){var f=this.get("ref");if(e.isLocal){var g=f.get(c(b),d).value();this.send("recordUpdatedLocally",a,b,g)}else{var g=f.get(c(b),d).value();this.send("recordUpdatedRemotely",a,b,g)}},identityMapChanged:function(a,b,d){var e=this.get("ref");if(d.isLocal&&null==d.oldValue&&d.newValue)this.send("recordCreatedLocally",a,b,d.newValue.get("id"));else if(d.isLocal&&d.oldValue&&null==d.newValue)this.send("recordDeletedLocally",a,b,d.oldValue.get("id"));else if(!d.isLocal&&null==d.oldValue&&d.newValue){var f=d.newValue.get("id"),g=e.get(c(b),f).value();this.send("recordCreatedRemotely",a,b,g)}else if(!d.isLocal&&d.oldValue&&null==d.newValue){var h=d.oldValue.get("id");this.send("recordDeletedRemotely",a,b,h)}}})}),define("ember-gdrive/document-source",["./document","./state","./loader","exports"],function(a,b,c,d){"use strict";var e=a["default"],f=b["default"],g=(c["default"],Ember.Object.extend({document:null,id:Ember.computed.alias("document.id"),isLoaded:Ember.computed.bool("id"),state:function(){return f.create()}.property(),openFromState:function(){var a=this.get("state");return a.get("isOpen")?this.load(a.get("fileID")):Ember.RSVP.Promise.reject("failed to open")},createFromState:function(){var a=this.get("state"),b=prompt("Enter a document name")||"Untitled document",c=this;return a.get("isCreate")?e.create({title:b}).then(function(a){return c.set("document",a),a}):Ember.RSVP.Promise.reject("failed to create")},load:function(a){Ember.assert("Document with id "+this.get("id")+" was already loaded",!this.get("isLoaded"));var b=this;return e.find(a).then(function(a){return b.set("document",a),a})}}));d["default"]=g}),define("ember-gdrive/document",["./reference","exports"],function(a,b){"use strict";var c=a["default"],d=Ember.Object.extend(Ember.Evented,{id:null,content:null,title:Ember.computed.alias("meta.title"),init:function(a,b){Ember.assert("You must pass in a valid google document.",!!a),this.set("content",a),this.set("id",b),this._loadMeta()},ref:function(){return new c(this.get("model"),null,null,this.get("root"))}.property("model","root").readOnly(),root:function(){return this.get("model").getRoot()}.property("model").readOnly(),model:function(){return this.get("content").getModel()}.property("content").readOnly(),meta:{},openSaveCount:0,beginSave:function(){this.get("model").beginCompoundOperation(),this.incrementProperty("openSaveCount")},endSave:function(){this.get("model").endCompoundOperation(),this.decrementProperty("openSaveCount")},undo:function(){this.canUndo()&&this.get("model").undo()},redo:function(){this.canRedo()&&this.get("model").redo()},canUndo:function(){return this.get("model").canUndo},canRedo:function(){return this.get("model").canRedo},_loadMeta:function(){var a=this;this._fetchMeta(this.get("id")).then(function(b){a.set("meta",b)})},_fetchMeta:function(a){return new Ember.RSVP.Promise(function(b,c){gapi.client.drive.files.get({fileId:a}).execute(function(a){a.error?c(a):b(a)})})}}),e={};d.reopenClass({find:function(a){return e[a]?e[a]:(e[a]=new Ember.RSVP.Promise(function(b,c){gapi.drive.realtime.load(a,function(a){Ember.run(null,b,a)},Ember.K,function(a){Ember.run(null,c,a)})}).then(function(b){return new d(b,a)},function(b){throw delete e[a],console.log("oh my, gonna make an error"),new Error(b.type==gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?"Token refresh required":b.type==gapi.drive.realtime.ErrorType.CLIENT_ERROR?"An Error happened: "+b.message:b.type==gapi.drive.realtime.ErrorType.NOT_FOUND?"The file was not found. It does not exist or you do not have read access to the file.":"Unknown error occured'")}),e[a])},create:function(a){return this._sendCreateRequest(a).then(function(a){return a.error?Ember.RSVP.reject(new Error(a.error.message)):d.find(a.id)})},_sendCreateRequest:function(a){return new Ember.RSVP.Promise(function(b){gapi.client.drive.files.insert({resource:{mimeType:ENV.GOOGLE_MIME_TYPE,title:Ember.get(a,"title")}}).execute(function(a){Ember.run(null,b,a)})})}}),b["default"]=d}),define("ember-gdrive/loader",["exports"],function(a){"use strict";var b={};b.promise=null,b.loaded=0,b.libraryCount=4,b.load=function(){return b.promise?b.promise:(b.promise=new Ember.RSVP.Promise(function(a){gapi.load("auth:client,drive-realtime,drive-share",function(){gapi.client.load("oauth2","v2",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.client.load("drive","v2",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.load("drive-share",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.load("picker",function(){b.loaded++,b.loaded>=b.libraryCount&&a()})})}),b.promise)},b.load(),a["default"]=b}),define("ember-gdrive/picker",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend(Ember.Evented,{token:null,apiKey:ENV.GOOGLE_API_KEY,mimeTypes:ENV.GOOGLE_MIME_TYPE,show:function(){this.get("googlePicker").setVisible(!0)},googlePicker:function(){var a=this.googlePickerCallback.bind(this),b=this.get("token"),c=this.get("apiKey"),d=this.get("mimeTypes"),e=new google.picker.View(google.picker.ViewId.DOCS);return e.setMimeTypes(d),(new google.picker.PickerBuilder).addView(e).enableFeature(google.picker.Feature.NAV_HIDDEN).setDeveloperKey(c).setSelectableMimeTypes(d).setOAuthToken(b).setCallback(a).build()}.property("token"),googlePickerCallback:function(a){a.action==google.picker.Action.PICKED&&this.trigger("selected",a.docs[0])}})}),define("ember-gdrive/reference",["exports"],function(a){"use strict";var b=function(a,b){if(!b)throw new Error("Assertion failed: "+a)},c=function(a){return Object(a)===a&&Object.getPrototypeOf(a)===Object.prototype},d=function(a){return a instanceof Array},e=function(){if(d(arguments[0]))return e.apply(this,arguments[0]);for(var a=arguments,b=this,c=0;c<a.length;c++)b=b._get(a[c]);return b},f=function(a,b,c,d){this.model=a,this.parent=b,this.key=c,this.data=d};f.isFor=function(a){return a instanceof gapi.drive.realtime.CollaborativeMap},f.serialize=function(a){var b={};return a.items().forEach(function(a){b[a[0]]=i(a[1])}),b},f.prototype.path=function(a){return this.parent?this.parent.path(this.key)+(a?"/"+a:""):a||""},f.prototype.keys=function(){return this.data.keys()},f.prototype.get=function(){return e.apply(this,arguments)},f.prototype._get=function(a){var b=this.data.get(a);return g.isFor(b)?new g(this.model,this,a):f.isFor(b)?new f(this.model,this,a,b):b},f.prototype.set=function(a){if(arguments.length>1)this.data.set(arguments[0],this._coerce(arguments[1]));else if(c(a)){this.data.clear();for(var b=Object.keys(a),d=0;d<b.length;d++)this.data.set(b[d],a[b[d]])}else this.parent.set(this.key,a);return this.parent?this.parent.get(this.key):this},f.prototype.value=function(){return i(this.data)},f.prototype.delete=function(a){return this.data.delete(a),this},f.prototype.clear=function(){return this.data.clear(),this},f.prototype.materialize=function(){return this},f.prototype.changed=function(a){return this.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,a),this.data.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,a),this},f.prototype._coerce=function(a){return c(a)?this.model.createMap(a):a},f.prototype.value=function(){return i(this.data)};var g=function(a,b,c){this.model=a,this.parent=b,this.key=c};g.isFor=function(a){return null==a},g.prototype.path=function(a){return this.parent.path(this.key)+(a?"/"+a:"")},g.prototype.keys=function(){return[]},g.prototype.get=function(){return e.apply(this,arguments)},g.prototype._get=function(a){return new g(this.model,this,a)},g.prototype.set=function(a){var b=this.materialize();return b.set(a),b},g.prototype.delete=function(){return this},g.prototype.value=function(){return null},g.prototype.materialize=function(){var a=this.parent.materialize();return a.set(this.key,this.model.createMap()),a.get(this.key)},g.prototype.changed=function(){b("You must materialize a NullReference before adding a listener")};var h=function(a){var b=[];return a.asArray().forEach(function(a){b.push(i(a))}),b},i=function(a){return f.isFor(a)?f.serialize(a):a instanceof gapi.drive.realtime.CollaborativeList?h(a):a};a["default"]=f}),define("ember-gdrive/serializer",["./util","exports"],function(a,b){"use strict";var c=a.recordKey,d=function(a){return a.get("id")},e=function(a){return{id:a.get("id"),type:c(a)}},f=DS.JSONSerializer.extend({serializeHasMany:function(a,b,c){var f=c.key,g=DS.RelationshipChange.determineRelationshipType(a.constructor,c);if("manyToNone"===g||"manyToMany"===g){var h=c.options.polymorphic?e:d;b[f]=Ember.get(a,f).map(h)}}});b["default"]=f}),define("ember-gdrive/share-dialog",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend({documentId:Ember.required(),show:function(){var a=new gapi.drive.share.ShareClient(ENV.GOOGLE_DRIVE_SDK_APP_ID);a.setItemIds([this.get("documentId")]),a.showSettingsDialog()}})}),define("ember-gdrive/state",["./uri","exports"],function(a,b){"use strict";var c=a.extractQueryParams,d=a.clearQueryString;b["default"]=Ember.Object.extend({init:function(){this.set("queryParams",c()),d()},fileID:function(){return this.get("fileIDs").objectAt(0)}.property("fileIDs"),isOpen:function(){return"open"==this.get("action")}.property("action"),isCreate:function(){return"create"==this.get("action")}.property("action"),state:function(){try{return JSON.parse(this.get("queryParams.state"))}catch(a){return null}}.property("queryParams"),action:Ember.computed.alias("state.action"),userID:Ember.computed.alias("state.userId"),fileIDs:Ember.computed.alias("state.ids"),folderID:Ember.computed.alias("state.folderId"),queryParams:{}})}),define("ember-gdrive/store-extensions",[],function(){"use strict";DS.Store.reopen({undo:function(){this._defaultAdapter().undo()},redo:function(){this._defaultAdapter().redo()},beginSave:function(a){this._defaultAdapter().beginSave(a)},endSave:function(a){this._defaultAdapter().endSave(a)},beginOperation:function(a){this._defaultAdapter().beginSave(a),window.autoSaveSuspended=!0},endOperation:function(a){Ember.run.schedule("afterRender",this,function(){this._defaultAdapter().endSave(a),window.autoSaveSuspended=!1})},_defaultAdapter:function(){return this.container.lookup("adapter:application")}})}),define("ember-gdrive/uri",["exports"],function(a){"use strict";var b=function(){var a={};return location.search.substr(1).split("&").forEach(function(b){a[b.split("=")[0]]=decodeURIComponent(b.split("=")[1])}),a},c=function(){var a=window.location.toString();if(a.indexOf("?")>0){var b=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,b)}};a.extractQueryParams=b,a.clearQueryString=c}),define("ember-gdrive/util",["exports"],function(a){"use strict";var b=function(a){return Ember.String.dasherize(a)},c=function(a){return b(a.typeKey)},d=function(a){return c(a.constructor)},e=function(a,b){return a.map(function(a){return a[b]})};a.normalizeTypeKey=b,a.modelKey=c,a.recordKey=d,a.pluck=e}),define("ember-gdrive/uuid",["exports"],function(a){"use strict";a["default"]=function(){var a=10;return new Array(a+1).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,a)}}),define("ember-gdrive",["ember-gdrive/store-extensions","ember-gdrive/boot"],function(){"use strict";Ember.Application.reopen({create:function(){Ember.assert("You must implement create() for Ember.Application")},open:function(){Ember.assert("You must implement open(id) for Ember.Application")}})})}();