!function(){define("ember-gdrive/adapter",["./uuid","./document","./change-observer","./util","exports"],function(a,b,c,d,e){"use strict";var f=a["default"],g=(b["default"],c["default"]),h=d.modelKey,i=DS.Adapter.extend({defaultSerializer:"-google-drive",documentSource:null,document:Ember.computed.alias("documentSource.document"),namespace:"v1",ref:function(){var a=this.get("document.ref"),b=this.get("namespace");return a.get(b).materialize()}.property("document.ref","namespace"),recordCreatedRemotely:function(a,b,c){a.push(b,c)},recordUpdatedRemotely:function(a,b,c){a.push(b,c)},recordDeletedRemotely:function(a,b,c){var d=a.getById(b,c);a.unloadRecord(d)},recordCreatedLocally:function(a,b,c){a.push(b,c)},recordUpdatedLocally:function(a,b,c){a.push(b,c)},recordDeletedLocally:function(a,b,c){var d=a.getById(b,c);d&&!d.get("isDeleted")&&d.destroyRecord()},changeObserver:function(){return g.create({ref:this.get("ref"),target:this})}.property(),observeRecordData:function(a,b,c){return this.get("changeObserver").observeRecordData(a,b,c)},observeIdentityMap:function(a,b){return this.get("changeObserver").observeIdentityMap(a,b)},generateIdForRecord:function(){return f()},find:function(a,b,c){return this.observeRecordData(a,b.typeKey,c),Ember.RSVP.resolve(this.get("ref").get(h(b),c).value())},createRecord:function(a,b,c){var d=c.serialize({includeId:!0}),e=c.get("id"),f=this.get("ref");return this.beginSave("createRecord"),f.get(h(b),e).set(d),this.endSave("createRecord"),this.observeRecordData(a,b.typeKey,e),Ember.RSVP.resolve(this.get("ref").get(h(b),e).value())},updateRecord:function(a,b,c){var d=c.serialize({includeId:!0}),e=c.get("id"),f=this.get("ref");return this.beginSave("updateRecord"),f.get(h(b),e).set(d),this.endSave("updateRecord"),this.observeRecordData(a,b.typeKey,e),Ember.RSVP.resolve(f.get(h(b),e).value())},findAll:function(a,b){for(var c=this,d=this.get("ref"),e=d.get(h(b)).value()||{},f=d.get(h(b)).keys(),g=[],i=0;i<f.length;i++)g.push(e[f[i]]);return this.observeIdentityMap(a,b.typeKey),g.forEach(function(d){c.observeRecordData(a,b.typeKey,d.id)}),Ember.RSVP.resolve(g)},deleteRecord:function(a,b,c){var d=this.get("ref"),e=c.get("id");return d.get(h(b)).delete(e),Ember.RSVP.resolve()},undo:function(){this.get("document").undo()},redo:function(){this.get("document").redo()},beginSave:function(a){this.get("document").beginSave(a)},endSave:function(a){this.get("document").endSave(a)}});e["default"]=i}),define("ember-gdrive/auth",["exports"],function(a){"use strict";var b="https://www.googleapis.com/auth/drive.install",c="https://www.googleapis.com/auth/drive.file",d="openid",e=function(a,b){return Ember.merge(a||{},b||{})},f=Ember.Object.extend();f.reopenClass({isAuthenticated:!1,isUnauthenticated:Ember.computed.not("isAuthenticated"),user:null,userID:Ember.computed.alias("user.id"),clientID:ENV.GOOGLE_CLIENT_ID,permissions:[b,c,d],authorize:function(a){var b=e({client_id:this.clientID,scope:this.permissions,authuser:-1,immediate:!1},a||{});return new Ember.RSVP.Promise(function(a,c){console.log("authorize",b),gapi.auth.authorize(b,function(b){b&&!b.error?Ember.run(null,a,b):Ember.run(null,c,b&&b.error?b.error:"unauthenticated")})},"ember-gdrive: Auth#authorize")},authorizeImmediate:function(a){return this.authorize(e({immediate:!0},a))},fetchCurrentUser:function(){return new Ember.RSVP.Promise(function(a,b){gapi.client.oauth2.userinfo.get().execute(function(c){c.id?Ember.run(null,a,c):Ember.run(null,b)})},"GoogleDriveAuth _fetchUserObject")},close:function(){return new Ember.RSVP.Promise(function(a){gapi.auth.signOut(),a()})}}),a["default"]=f}),define("ember-gdrive/boot",["ember-gdrive/auth","ember-gdrive/document-source","ember-gdrive/loader","ember-gdrive/adapter","ember-gdrive/serializer"],function(a,b,c,d,e){"use strict";var f=a["default"],g=b["default"],h=c["default"],i=d["default"],j=e["default"];Ember.onLoad("Ember.Application",function(a){a.initializer({name:"google-drive",after:"store",initialize:function(a,b){b.register("adapter:-google-drive",i),b.register("serializer:-google-drive",j),b.register("document-source:main",g),b.inject("route","documentSource","document-source:main"),b.inject("controller","documentSource","document-source:main"),b.inject("adapter:application","documentSource","document-source:main")}}),a.initializer({name:"requireGoogleLibraries",before:"googleDriveAuth",initialize:function(a,b){b.deferReadiness(),h.load().then(function(){b.advanceReadiness()})}}),a.initializer({name:"googleDriveAuth",before:"store",initialize:function(a,b){b.register("auth:google",f,{instantiate:!1}),b.inject("controller","auth","auth:google"),b.inject("route","auth","auth:google")}})})}),define("ember-gdrive/change-observer",["./util","exports"],function(a,b){"use strict";function c(){}var d=a.normalizeTypeKey,e=(a.pluck,c);b["default"]=Ember.Object.extend(Ember.ActionHandler,{ref:null,target:null,observedMap:function(){return{}}.property(),observeRecordData:function(a,b,c){var e=this,f=this.get("observedMap"),g=[d(b),c].join("/"),h=this.get("ref");return f[g]?Ember.RSVP.Promise.resolve():(f[g]=!0,void h.get(d(b),c).changed(function(d){"value_changed"==d.type&&Ember.run(function(){e.recordDataChanged(a,b,c,d)})}))},observeIdentityMap:function(a,b){var c=this,e=this.get("observedMap"),f=[d(b)].join("/"),g=this.get("ref");return e[f]?Ember.RSVP.Promise.resolve():(e[f]=!0,void g.get(d(b)).materialize().changed(function(d){"value_changed"==d.type&&Ember.run.once(c,"identityMapChanged",a,b,d)}))},recordDataChanged:function(a,b,c,f){e(f);var g=this.get("ref"),h=g.get(d(b),c).value();h&&(f.isLocal?this.get("target").recordUpdatedLocally(a,b,h):this.get("target").recordUpdatedRemotely(a,b,h))},identityMapChanged:function(a,b,c){e(c);var f,g,h=this.get("ref");if(c.isLocal&&null==c.oldValue&&c.newValue)g=c.newValue.get("id"),f=h.get(d(b),g).value(),this.get("target").recordCreatedLocally(a,b,f);else if(c.isLocal&&c.oldValue&&null==c.newValue)this.get("target").recordDeletedLocally(a,b,c.oldValue.get("id"));else if(!c.isLocal&&null==c.oldValue&&c.newValue)g=c.newValue.get("id"),f=h.get(d(b),g).value(),this.get("target").recordCreatedRemotely(a,b,f);else if(!c.isLocal&&c.oldValue&&null==c.newValue){var i=c.oldValue.get("id");this.get("target").recordDeletedRemotely(a,b,i)}}})}),define("ember-gdrive/document-source",["./document","./state","./loader","exports"],function(a,b,c,d){"use strict";var e=a["default"],f=b["default"],g=(c["default"],Ember.Object.extend({document:null,id:Ember.computed.alias("document.id"),isLoaded:Ember.computed.bool("id"),state:function(){return f.create()}.property(),openFromState:function(){var a=this.get("state");return a.get("isOpen")?this.load(a.get("fileID")):Ember.RSVP.Promise.reject("failed to open")},createFromState:function(){var a=this.get("state"),b=this;if(a.get("isCreate")){var c=prompt("Enter a document name")||"Untitled document";return e.create({title:c}).then(function(a){return b.set("document",a),a})}return Ember.RSVP.Promise.reject("failed to create")},load:function(a){Ember.assert("Document with id "+this.get("id")+" was already loaded",!this.get("isLoaded"));var b=this;return e.find(a).then(function(a){return b.set("document",a),a})}}));d["default"]=g}),define("ember-gdrive/document",["./reference","exports"],function(a,b){"use strict";var c=a["default"],d=Ember.Object.extend(Ember.Evented,{id:null,content:null,title:Ember.computed.alias("meta.title"),hasUnsavedChanges:!1,isSaving:!1,canUndo:!1,canRedo:!1,collaborators:function(){return[]}.property(),isSaved:function(){return!this.get("hasUnsavedChanges")&&!this.get("isSaving")}.property("hasUnsavedChanges","isSaving"),init:function(a,b){Ember.assert("You must pass in a valid google document.",!!a),this.set("content",a),this.set("id",b),this._observeSaveState(),this._observeUndoRedoState(),this._observeCollaborators(),this._refreshCollaborators(),this._loadMeta()},ref:function(){var a=this.get("content"),b=a.getModel(),d=b.getRoot();return new c(b,null,null,d)}.property("content").readOnly(),meta:{},beginSave:function(){this.get("content").getModel().beginCompoundOperation()},endSave:function(){this.get("content").getModel().endCompoundOperation()},undo:function(){this.get("canUndo")&&this.get("content").getModel().undo()},redo:function(){this.get("canRedo")&&this.get("content").getModel().redo()},_observeSaveState:function(){var a=this,b=this.get("content");b.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,function(b){a.set("hasUnsavedChanges",b.isPending),a.set("isSaving",b.isSaving),a.get("isSaved")&&a.trigger("saved")})},_observeUndoRedoState:function(){var a=this,b=this.get("content");b.getModel().addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,function(b){a.set("canUndo",b.canUndo),a.set("canRedo",b.canRedo)})},_observeCollaborators:function(){var a=this,b=this.get("content");b.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_JOINED,function(){a._refreshCollaborators()}),b.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_LEFT,function(){a._refreshCollaborators()})},_refreshCollaborators:function(){var a=this.get("collaborators"),b=this.get("content");a.clear(),a.pushObjects(b.getCollaborators())},_loadMeta:function(){var a=this;this._fetchMeta(this.get("id")).then(function(b){a.set("meta",b)})},_fetchMeta:function(a){return new Ember.RSVP.Promise(function(b,c){gapi.client.drive.files.get({fileId:a}).execute(function(a){a.error?c(a):b(a)})})}}),e={};d.reopenClass({find:function(a){return e[a]?e[a]:(e[a]=new Ember.RSVP.Promise(function(b,c){gapi.drive.realtime.load(a,function(a){Ember.run(null,b,a)},Ember.K,function(a){Ember.run(null,c,a)})}).then(function(b){return new d(b,a)},function(b){throw delete e[a],console.log("oh my, gonna make an error"),new Error(b.type==gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?"Token refresh required":b.type==gapi.drive.realtime.ErrorType.CLIENT_ERROR?"An Error happened: "+b.message:b.type==gapi.drive.realtime.ErrorType.NOT_FOUND?"The file was not found. It does not exist or you do not have read access to the file.":"Unknown error occured'")}),e[a])},create:function(a){return this._sendCreateRequest(a).then(function(a){return a.error?Ember.RSVP.reject(new Error(a.error.message)):d.find(a.id)})},_sendCreateRequest:function(a){return new Ember.RSVP.Promise(function(b){gapi.client.drive.files.insert({resource:{mimeType:ENV.GOOGLE_MIME_TYPE,title:Ember.get(a,"title")}}).execute(function(a){Ember.run(null,b,a)})})}}),b["default"]=d}),define("ember-gdrive/loader",["exports"],function(a){"use strict";var b={};b.promise=null,b.loaded=0,b.libraryCount=4,b.load=function(){return b.promise?b.promise:(b.promise=new Ember.RSVP.Promise(function(a){gapi.load("auth:client,drive-realtime,drive-share",function(){gapi.client.load("oauth2","v2",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.client.load("drive","v2",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.load("drive-share",function(){b.loaded++,b.loaded>=b.libraryCount&&a()}),gapi.load("picker",function(){b.loaded++,b.loaded>=b.libraryCount&&a()})})}),b.promise)},b.load(),a["default"]=b}),define("ember-gdrive/picker",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend(Ember.Evented,{token:null,apiKey:ENV.GOOGLE_API_KEY,mimeTypes:ENV.GOOGLE_MIME_TYPE,show:function(){this.get("googlePicker").setVisible(!0)},googlePicker:function(){var a=this.googlePickerCallback.bind(this),b=this.get("token"),c=this.get("apiKey"),d=this.get("mimeTypes"),e=new google.picker.View(google.picker.ViewId.DOCS);return e.setMimeTypes(d),(new google.picker.PickerBuilder).addView(e).enableFeature(google.picker.Feature.NAV_HIDDEN).setDeveloperKey(c).setSelectableMimeTypes(d).setOAuthToken(b).setCallback(a).build()}.property("token"),googlePickerCallback:function(a){a.action==google.picker.Action.PICKED&&this.trigger("selected",a.docs[0])}})}),define("ember-gdrive/reference",["ember","exports"],function(a,b){"use strict";var c=a["default"],d=function(a){return Object(a)===a&&Object.getPrototypeOf(a)===Object.prototype},e=function(){if(c.isArray(arguments[0]))return e.apply(this,arguments[0]);for(var a=arguments,b=this,d=0;d<a.length;d++)b=b._get(a[d]);return b},f=function(a,b,c,d){this.model=a,this.parent=b,this.key=c,this.data=d};f.isFor=function(a){return a instanceof gapi.drive.realtime.CollaborativeMap},f.serialize=function(a){var b={};return a.items().forEach(function(a){b[a[0]]=i(a[1])}),b},f.prototype.path=function(a){return this.parent?this.parent.path(this.key)+(a?"/"+a:""):a||""},f.prototype.keys=function(){return this.data.keys()},f.prototype.get=function(){return e.apply(this,arguments)},f.prototype._get=function(a){var b=this.data.get(a);return g.isFor(b)?new g(this.model,this,a):f.isFor(b)?new f(this.model,this,a,b):b},f.prototype.set=function(a){if(arguments.length>1)void 0!==arguments[1]&&this.data.set(arguments[0],this._coerce(arguments[1]));else if(d(a))for(var b=Object.keys(a),c=0;c<b.length;c++)void 0!==a[b[c]]&&this.data.set(b[c],a[b[c]]);else this.parent.set(this.key,a);return this.parent?this.parent.get(this.key):this},f.prototype.value=function(){return i(this.data)},f.prototype.delete=function(a){return this.data.delete(a),this},f.prototype.clear=function(){return this.data.clear(),this},f.prototype.materialize=function(){return this},f.prototype.changed=function(a){return this.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,a),this.data.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,a),this},f.prototype._coerce=function(a){return d(a)?this.model.createMap(a):a},f.prototype.value=function(){return i(this.data)};var g=function(a,b,c){this.model=a,this.parent=b,this.key=c};g.isFor=function(a){return null==a},g.prototype.path=function(a){return this.parent.path(this.key)+(a?"/"+a:"")},g.prototype.keys=function(){return[]},g.prototype.get=function(){return e.apply(this,arguments)},g.prototype._get=function(a){return new g(this.model,this,a)},g.prototype.set=function(a){var b=this.materialize();return b.set(a),b},g.prototype.delete=function(){return this},g.prototype.value=function(){return null},g.prototype.materialize=function(){var a=this.parent.materialize();return a.set(this.key,this.model.createMap()),a.get(this.key)},g.prototype.changed=function(){c.assert("You must materialize a NullReference before adding a listener",!1)};var h=function(a){var b=[];return a.asArray().forEach(function(a){b.push(i(a))}),b},i=function(a){return f.isFor(a)?f.serialize(a):a instanceof gapi.drive.realtime.CollaborativeList?h(a):a};b["default"]=f}),define("ember-gdrive/serializer",["./util","exports"],function(a,b){"use strict";function c(a,b){return b.options.polymorphic?{id:a.get("id"),type:d(a)}:a.get("id")}var d=a.recordKey,e=DS.JSONSerializer.extend({serializeHasMany:function(a,b,d){var e=d.key,f=a.get(e);d.options.async&&f.get("isFulfilled")&&(f=f.get("content")),f&&(b[e]=f.map(function(a){return c(a,d)}))},serializeBelongsTo:function(a,b,d){if(d.options&&d.options.async){var e=d.key;a.get(e).get("isFulfilled")&&(b[e]=c(a.get(e).get("content"),d))}else this._super(a,b,d)}});b["default"]=e}),define("ember-gdrive/share-dialog",["exports"],function(a){"use strict";a["default"]=Ember.Object.extend({documentId:Ember.required(),show:function(){var a=new gapi.drive.share.ShareClient(ENV.GOOGLE_DRIVE_SDK_APP_ID);a.setItemIds([this.get("documentId")]),a.showSettingsDialog()}})}),define("ember-gdrive/state",["./uri","exports"],function(a,b){"use strict";var c=a.extractQueryParams,d=a.clearQueryString;b["default"]=Ember.Object.extend({init:function(){this.set("queryParams",c()),d()},fileID:function(){return this.get("fileIDs").objectAt(0)}.property("fileIDs"),isOpen:function(){return"open"==this.get("action")}.property("action"),isCreate:function(){return"create"==this.get("action")}.property("action"),state:function(){try{return JSON.parse(this.get("queryParams.state"))}catch(a){return null}}.property("queryParams"),action:Ember.computed.alias("state.action"),userID:Ember.computed.alias("state.userId"),fileIDs:Ember.computed.alias("state.ids"),folderID:Ember.computed.alias("state.folderId"),queryParams:{}})}),define("ember-gdrive/store-extensions",[],function(){"use strict";DS.Store.reopen({undo:function(){this._defaultAdapter().undo()},redo:function(){this._defaultAdapter().redo()},beginSave:function(a){this._defaultAdapter().beginSave(a)},endSave:function(a){this._defaultAdapter().endSave(a)},beginOperation:function(a){this._defaultAdapter().beginSave(a)},endOperation:function(a){Ember.run.schedule("afterRender",this,function(){this._defaultAdapter().endSave(a)})},_defaultAdapter:function(){return this.container.lookup("adapter:application")}})}),define("ember-gdrive/uri",["exports"],function(a){"use strict";var b=function(){var a={};return location.search.substr(1).split("&").forEach(function(b){a[b.split("=")[0]]=decodeURIComponent(b.split("=")[1])}),a},c=function(){var a=window.location.toString();if(a.indexOf("?")>0){var b=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,b)}};a.extractQueryParams=b,a.clearQueryString=c}),define("ember-gdrive/util",["exports"],function(a){"use strict";var b=function(a){return Ember.String.dasherize(a)},c=function(a){return b(a.typeKey)},d=function(a){return c(a.constructor)},e=function(a,b){return a.map(function(a){return a[b]})};a.normalizeTypeKey=b,a.modelKey=c,a.recordKey=d,a.pluck=e}),define("ember-gdrive/uuid",["exports"],function(a){"use strict";a["default"]=function(){var a=10;return new Array(a+1).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,a)}}),define("ember-gdrive",["ember-gdrive/store-extensions","ember-gdrive/boot"],function(){"use strict";Ember.Application.reopen({create:function(){Ember.assert("You must implement create() for Ember.Application")},open:function(){Ember.assert("You must implement open(id) for Ember.Application")}})})}();